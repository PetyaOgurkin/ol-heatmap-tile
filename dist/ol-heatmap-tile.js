var HeatmapTile;(()=>{"use strict";var t={d:(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};(()=>{t.r(e),t.d(e,{HeatmapTile:()=>zr});var r={RADIANS:"radians",DEGREES:"degrees",FEET:"ft",METERS:"m",PIXELS:"pixels",TILE_PIXELS:"tile-pixels",USFEET:"us-ft"},n={};n[r.RADIANS]=6370997/(2*Math.PI),n[r.DEGREES]=2*Math.PI*6370997/360,n[r.FEET]=.3048,n[r.METERS]=1,n[r.USFEET]=1200/3937;const o=r,i=function(){function t(t){this.code_=t.code,this.units_=t.units,this.extent_=void 0!==t.extent?t.extent:null,this.worldExtent_=void 0!==t.worldExtent?t.worldExtent:null,this.axisOrientation_=void 0!==t.axisOrientation?t.axisOrientation:"enu",this.global_=void 0!==t.global&&t.global,this.canWrapX_=!(!this.global_||!this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}return t.prototype.canWrapX=function(){return this.canWrapX_},t.prototype.getCode=function(){return this.code_},t.prototype.getExtent=function(){return this.extent_},t.prototype.getUnits=function(){return this.units_},t.prototype.getMetersPerUnit=function(){return this.metersPerUnit_||n[this.units_]},t.prototype.getWorldExtent=function(){return this.worldExtent_},t.prototype.getAxisOrientation=function(){return this.axisOrientation_},t.prototype.isGlobal=function(){return this.global_},t.prototype.setGlobal=function(t){this.global_=t,this.canWrapX_=!(!t||!this.extent_)},t.prototype.getDefaultTileGrid=function(){return this.defaultTileGrid_},t.prototype.setDefaultTileGrid=function(t){this.defaultTileGrid_=t},t.prototype.setExtent=function(t){this.extent_=t,this.canWrapX_=!(!this.global_||!t)},t.prototype.setWorldExtent=function(t){this.worldExtent_=t},t.prototype.setGetPointResolution=function(t){this.getPointResolutionFunc_=t},t.prototype.getPointResolutionFunc=function(){return this.getPointResolutionFunc_},t}();function s(t,e,r){return Math.min(Math.max(t,e),r)}var a,u="cosh"in Math?Math.cosh:function(t){var e=Math.exp(t);return(e+1/e)/2},l="log2"in Math?Math.log2:function(t){return Math.log(t)*Math.LOG2E},c=(a=function(t,e){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},a(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),h=6378137,p=Math.PI*h,f=[-p,-p,p,p],d=[-180,-85,180,85],g=h*Math.log(Math.tan(Math.PI/2)),_=function(t){function e(e){return t.call(this,{code:e,units:o.METERS,extent:f,global:!0,worldExtent:d,getPointResolution:function(t,e){return t/u(e[1]/h)}})||this}return c(e,t),e}(i),y=[new _("EPSG:3857"),new _("EPSG:102100"),new _("EPSG:102113"),new _("EPSG:900913"),new _("http://www.opengis.net/def/crs/EPSG/0/3857"),new _("http://www.opengis.net/gml/srs/epsg.xml#3857")];var v=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),m=[-180,-90,180,90],x=6378137*Math.PI/180,T=function(t){function e(e,r){return t.call(this,{code:e,units:o.DEGREES,extent:m,axisOrientation:r,global:!0,metersPerUnit:x,worldExtent:m})||this}return v(e,t),e}(i),E=[new T("CRS:84"),new T("EPSG:4326","neu"),new T("urn:ogc:def:crs:OGC:1.3:CRS84"),new T("urn:ogc:def:crs:OGC:2:84"),new T("http://www.opengis.net/def/crs/OGC/1.3/CRS84","neu"),new T("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new T("http://www.opengis.net/def/crs/EPSG/0/4326","neu")],b={},w={};function R(t,e,r){var n=t.getCode(),o=e.getCode();n in w||(w[n]={}),w[n][o]=r}const S="top-left";function C(){return function(){throw new Error("Unimplemented abstract method.")}()}var P=0;function O(t){return t.ol_uid||(t.ol_uid=String(++P))}var A=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const L=function(t){function e(e){var r=this,n="Assertion failed. See https://openlayers.org/en/v"+"6.9.0".split("-")[0]+"/doc/errors/#"+e+" for details.";return(r=t.call(this,n)||this).code=e,r.name="AssertionError",r.message=n,r}return A(e,t),e}(Error);function G(t,e){if(!t)throw new L(e)}function M(t,e,r,n,o){return o?(o[0]=t,o[1]=e,o[2]=r,o[3]=n,o):[t,e,r,n]}function F(t,e){var r;return"bottom-left"===e?r=function(t){return[t[0],t[1]]}(t):"bottom-right"===e?r=function(t){return[t[2],t[1]]}(t):e===S?r=j(t):"top-right"===e?r=function(t){return[t[2],t[3]]}(t):G(!1,13),r}function I(t){return t[3]-t[1]}function U(t,e,r){var n=r||[1/0,1/0,-1/0,-1/0];return function(t,e){return t[0]<=e[2]&&t[2]>=e[0]&&t[1]<=e[3]&&t[3]>=e[1]}(t,e)?(t[0]>e[0]?n[0]=t[0]:n[0]=e[0],t[1]>e[1]?n[1]=t[1]:n[1]=e[1],t[2]<e[2]?n[2]=t[2]:n[2]=e[2],t[3]<e[3]?n[3]=t[3]:n[3]=e[3]):function(t){M(1/0,1/0,-1/0,-1/0,t)}(n),n}function j(t){return[t[0],t[3]]}function X(t){return t[2]-t[0]}function z(t,e,r){var n;if(void 0!==e){for(var o=0,i=t.length;o<i;++o)e[o]=t[o];n=e}else n=t.slice();return n}function D(t,e,r){if(void 0!==e&&t!==e){for(var n=0,o=t.length;n<o;++n)e[n]=t[n];t=e}return t}function B(t){!function(t,e){b[t]=e}(t.getCode(),t),R(t,t,z)}function N(t){return"string"==typeof t?b[e=t]||b[e.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null:t||null;var e}function Z(t){!function(t){t.forEach(B)}(t),t.forEach((function(e){t.forEach((function(t){e!==t&&R(e,t,z)}))}))}function Y(t,e){var r=function(t,e){var r;return t in w&&e in w[t]&&(r=w[t][e]),r}(t.getCode(),e.getCode());return r||(r=D),r}function k(t,e){return Y(N(t),N(e))}function W(t,e,r){return k(e,r)(t,void 0,t.length)}var V,K,H;Z(y),Z(E),V=y,K=function(t,e,r){var n=t.length,o=r>1?r:2,i=e;void 0===i&&(i=o>2?t.slice():new Array(n));for(var s=0;s<n;s+=o){i[s]=p*t[s]/180;var a=h*Math.log(Math.tan(Math.PI*(+t[s+1]+90)/360));a>g?a=g:a<-g&&(a=-g),i[s+1]=a}return i},H=function(t,e,r){var n=t.length,o=r>1?r:2,i=e;void 0===i&&(i=o>2?t.slice():new Array(n));for(var s=0;s<n;s+=o)i[s]=180*t[s]/p,i[s+1]=360*Math.atan(Math.exp(t[s+1]/h))/Math.PI-90;return i},E.forEach((function(t){V.forEach((function(e){R(t,e,K),R(e,t,H)}))}));const q=function(){function t(){this.disposed=!1}return t.prototype.dispose=function(){this.disposed||(this.disposed=!0,this.disposeInternal())},t.prototype.disposeInternal=function(){},t}(),$=function(){function t(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}return t.prototype.preventDefault=function(){this.defaultPrevented=!0},t.prototype.stopPropagation=function(){this.propagationStopped=!0},t}();function J(){}var Q="function"==typeof Object.assign?Object.assign:function(t,e){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var r=Object(t),n=1,o=arguments.length;n<o;++n){var i=arguments[n];if(null!=i)for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])}return r};function tt(t){for(var e in t)delete t[e]}"function"==typeof Object.values&&Object.values;var et=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const rt=function(t){function e(e){var r=t.call(this)||this;return r.eventTarget_=e,r.pendingRemovals_=null,r.dispatching_=null,r.listeners_=null,r}return et(e,t),e.prototype.addEventListener=function(t,e){if(t&&e){var r=this.listeners_||(this.listeners_={}),n=r[t]||(r[t]=[]);-1===n.indexOf(e)&&n.push(e)}},e.prototype.dispatchEvent=function(t){var e="string"==typeof t?new $(t):t,r=e.type;e.target||(e.target=this.eventTarget_||this);var n,o=this.listeners_&&this.listeners_[r];if(o){var i=this.dispatching_||(this.dispatching_={}),s=this.pendingRemovals_||(this.pendingRemovals_={});r in i||(i[r]=0,s[r]=0),++i[r];for(var a=0,u=o.length;a<u;++a)if(!1===(n="handleEvent"in o[a]?o[a].handleEvent(e):o[a].call(this,e))||e.propagationStopped){n=!1;break}if(--i[r],0===i[r]){var l=s[r];for(delete s[r];l--;)this.removeEventListener(r,J);delete i[r]}return n}},e.prototype.disposeInternal=function(){this.listeners_&&tt(this.listeners_)},e.prototype.getListeners=function(t){return this.listeners_&&this.listeners_[t]||void 0},e.prototype.hasListener=function(t){return!!this.listeners_&&(t?t in this.listeners_:Object.keys(this.listeners_).length>0)},e.prototype.removeEventListener=function(t,e){var r=this.listeners_&&this.listeners_[t];if(r){var n=r.indexOf(e);-1!==n&&(this.pendingRemovals_&&t in this.pendingRemovals_?(r[n]=J,++this.pendingRemovals_[t]):(r.splice(n,1),0===r.length&&delete this.listeners_[t]))}},e}(q),nt="change";var ot=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const it=function(t){function e(e,r,n){var o=t.call(this)||this,i=n||{};return o.tileCoord=e,o.state=r,o.interimTile=null,o.key="",o.transition_=void 0===i.transition?250:i.transition,o.transitionStarts_={},o}return ot(e,t),e.prototype.changed=function(){this.dispatchEvent(nt)},e.prototype.release=function(){},e.prototype.getKey=function(){return this.key+"/"+this.tileCoord},e.prototype.getInterimTile=function(){if(!this.interimTile)return this;var t=this.interimTile;do{if(2==t.getState())return this.transition_=0,t;t=t.interimTile}while(t);return this},e.prototype.refreshInterimChain=function(){if(this.interimTile){var t=this.interimTile,e=this;do{if(2==t.getState()){t.interimTile=null;break}1==t.getState()?e=t:0==t.getState()?e.interimTile=t.interimTile:e=t,t=e.interimTile}while(t)}},e.prototype.getTileCoord=function(){return this.tileCoord},e.prototype.getState=function(){return this.state},e.prototype.setState=function(t){if(3!==this.state&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()},e.prototype.load=function(){C()},e.prototype.getAlpha=function(t,e){if(!this.transition_)return 1;var r=this.transitionStarts_[t];if(r){if(-1===r)return 1}else r=e,this.transitionStarts_[t]=r;var n,o=e-r+1e3/60;return o>=this.transition_?1:(n=o/this.transition_,Math.pow(n,3))},e.prototype.inTransition=function(t){return!!this.transition_&&-1!==this.transitionStarts_[t]},e.prototype.endTransition=function(t){this.transition_&&(this.transitionStarts_[t]=-1)},e}(rt);var st=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const at=function(t){function e(e){var r=this;return(r=t.call(this,e.tileCoord,0,{transition:e.transition})||this).loader_=e.loader,r.data_=null,r.error_=null,r}return st(e,t),e.prototype.getData=function(){return this.data_},e.prototype.getError=function(){return this.error_},e.prototype.load=function(){this.state=1,this.changed();var t=this;this.loader_().then((function(e){t.data_=e,t.state=2,t.changed()})).catch((function(e){t.error_=e,t.state=3,t.changed()}))},e}(it);function ut(t,e,r,n,o){if(n&&n!==t&&(r=r.bind(n)),o){var i=r;r=function(){t.removeEventListener(e,r),i.apply(this,arguments)}}var s={target:t,type:e,listener:r};return t.addEventListener(e,r),s}function lt(t,e,r,n){return ut(t,e,r,n,!0)}function ct(t){t&&t.target&&(t.target.removeEventListener(t.type,t.listener),tt(t))}var ht=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),pt=function(t){function e(){var e=t.call(this)||this;return e.on=e.onInternal,e.once=e.onceInternal,e.un=e.unInternal,e.revision_=0,e}return ht(e,t),e.prototype.changed=function(){++this.revision_,this.dispatchEvent(nt)},e.prototype.getRevision=function(){return this.revision_},e.prototype.onInternal=function(t,e){if(Array.isArray(t)){for(var r=t.length,n=new Array(r),o=0;o<r;++o)n[o]=ut(this,t[o],e);return n}return ut(this,t,e)},e.prototype.onceInternal=function(t,e){var r;if(Array.isArray(t)){var n=t.length;r=new Array(n);for(var o=0;o<n;++o)r[o]=lt(this,t[o],e)}else r=lt(this,t,e);return e.ol_key=r,r},e.prototype.unInternal=function(t,e){var r=e.ol_key;if(r)!function(t){if(Array.isArray(t))for(var e=0,r=t.length;e<r;++e)ct(t[e]);else ct(t)}(r);else if(Array.isArray(t))for(var n=0,o=t.length;n<o;++n)this.removeEventListener(t[n],e);else this.removeEventListener(t,e)},e}(rt);pt.prototype.on,pt.prototype.once,pt.prototype.un;const ft=pt;var dt=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),gt=function(t){function e(e,r,n){var o=t.call(this,e)||this;return o.key=r,o.oldValue=n,o}return dt(e,t),e}($);const _t=function(t){function e(e){var r=t.call(this)||this;return r.on,r.once,r.un,O(r),r.values_=null,void 0!==e&&r.setProperties(e),r}return dt(e,t),e.prototype.get=function(t){var e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e},e.prototype.getKeys=function(){return this.values_&&Object.keys(this.values_)||[]},e.prototype.getProperties=function(){return this.values_&&Q({},this.values_)||{}},e.prototype.hasProperties=function(){return!!this.values_},e.prototype.notify=function(t,e){var r;r="change:"+t,this.dispatchEvent(new gt(r,t,e)),r="propertychange",this.dispatchEvent(new gt(r,t,e))},e.prototype.addChangeListener=function(t,e){this.addEventListener("change:"+t,e)},e.prototype.removeChangeListener=function(t,e){this.removeEventListener("change:"+t,e)},e.prototype.set=function(t,e,r){var n=this.values_||(this.values_={});if(r)n[t]=e;else{var o=n[t];n[t]=e,o!==e&&this.notify(t,o)}},e.prototype.setProperties=function(t,e){for(var r in t)this.set(r,t[r],e)},e.prototype.applyProperties=function(t){t.values_&&Q(this.values_||(this.values_={}),t.values_)},e.prototype.unset=function(t,e){if(this.values_&&t in this.values_){var r=this.values_[t];delete this.values_[t],function(t){var e;for(e in t)return!1;return!e}(this.values_)&&(this.values_=null),e||this.notify(t,r)}},e}(ft),yt="ready";var vt=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();function mt(t){return t?Array.isArray(t)?function(e){return t}:"function"==typeof t?t:function(e){return[t]}:null}const xt=function(t){function e(e){var r=t.call(this)||this;r.projection=N(e.projection),r.attributions_=mt(e.attributions),r.attributionsCollapsible_=void 0===e.attributionsCollapsible||e.attributionsCollapsible,r.loading=!1,r.state_=void 0!==e.state?e.state:yt,r.wrapX_=void 0!==e.wrapX&&e.wrapX,r.viewResolver=null,r.viewRejector=null;var n=r;return r.viewPromise_=new Promise((function(t,e){n.viewResolver=t,n.viewRejector=e})),r}return vt(e,t),e.prototype.getAttributions=function(){return this.attributions_},e.prototype.getAttributionsCollapsible=function(){return this.attributionsCollapsible_},e.prototype.getProjection=function(){return this.projection},e.prototype.getResolutions=function(){return C()},e.prototype.getView=function(){return this.viewPromise_},e.prototype.getState=function(){return this.state_},e.prototype.getWrapX=function(){return this.wrapX_},e.prototype.getContextOptions=function(){},e.prototype.refresh=function(){this.changed()},e.prototype.setAttributions=function(t){this.attributions_=mt(t),this.changed()},e.prototype.setState=function(t){this.state_=t,this.changed()},e}(_t),Tt=function(){function t(t){this.highWaterMark=void 0!==t?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}return t.prototype.canExpireCache=function(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark},t.prototype.clear=function(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null},t.prototype.containsKey=function(t){return this.entries_.hasOwnProperty(t)},t.prototype.forEach=function(t){for(var e=this.oldest_;e;)t(e.value_,e.key_,this),e=e.newer},t.prototype.get=function(t,e){var r=this.entries_[t];return G(void 0!==r,15),r===this.newest_||(r===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(r.newer.older=r.older,r.older.newer=r.newer),r.newer=null,r.older=this.newest_,this.newest_.newer=r,this.newest_=r),r.value_},t.prototype.remove=function(t){var e=this.entries_[t];return G(void 0!==e,15),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[t],--this.count_,e.value_},t.prototype.getCount=function(){return this.count_},t.prototype.getKeys=function(){var t,e=new Array(this.count_),r=0;for(t=this.newest_;t;t=t.older)e[r++]=t.key_;return e},t.prototype.getValues=function(){var t,e=new Array(this.count_),r=0;for(t=this.newest_;t;t=t.older)e[r++]=t.value_;return e},t.prototype.peekLast=function(){return this.oldest_.value_},t.prototype.peekLastKey=function(){return this.oldest_.key_},t.prototype.peekFirstKey=function(){return this.newest_.key_},t.prototype.pop=function(){var t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_},t.prototype.replace=function(t,e){this.get(t),this.entries_[t].value_=e},t.prototype.set=function(t,e){G(!(t in this.entries_),16);var r={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=r:this.oldest_=r,this.newest_=r,this.entries_[t]=r,++this.count_},t.prototype.setSize=function(t){this.highWaterMark=t},t}();function Et(t,e,r,n){return void 0!==n?(n[0]=t,n[1]=e,n[2]=r,n):[t,e,r]}function bt(t,e,r){return t+"/"+e+"/"+r}function wt(t){return bt(t[0],t[1],t[2])}var Rt=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const St=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Rt(e,t),e.prototype.expireCache=function(t){for(;this.canExpireCache()&&!(this.peekLast().getKey()in t);)this.pop().release()},e.prototype.pruneExceptNewestZ=function(){if(0!==this.getCount()){var t=this.peekFirstKey().split("/").map(Number)[0];this.forEach(function(e){e.tileCoord[0]!==t&&(this.remove(wt(e.tileCoord)),e.release())}.bind(this))}},e}(Tt);var Ct=function(){function t(t,e,r,n){this.minX=t,this.maxX=e,this.minY=r,this.maxY=n}return t.prototype.contains=function(t){return this.containsXY(t[1],t[2])},t.prototype.containsTileRange=function(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY},t.prototype.containsXY=function(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY},t.prototype.equals=function(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY},t.prototype.extend=function(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)},t.prototype.getHeight=function(){return this.maxY-this.minY+1},t.prototype.getSize=function(){return[this.getWidth(),this.getHeight()]},t.prototype.getWidth=function(){return this.maxX-this.minX+1},t.prototype.intersects=function(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY},t}();function Pt(t,e,r,n,o){return void 0!==o?(o.minX=t,o.maxX=e,o.minY=r,o.maxY=n,o):new Ct(t,e,r,n)}const Ot=Ct;function At(t,e){return t>e?1:t<e?-1:0}function Lt(t,e){return Array.isArray(t)?t:(void 0===e?e=[t,t]:(e[0]=t,e[1]=t),e)}var Gt=[0,0,0];const Mt=function(){function t(t){var e,r,n;if(this.minZoom=void 0!==t.minZoom?t.minZoom:0,this.resolutions_=t.resolutions,G((e=this.resolutions_,!0,r=function(t,e){return e-t}||At,e.every((function(t,n){if(0===n)return!0;var o=r(e[n-1],t);return!(o>0||0===o)}))),17),!t.origins)for(var o=0,i=this.resolutions_.length-1;o<i;++o)if(n){if(this.resolutions_[o]/this.resolutions_[o+1]!==n){n=void 0;break}}else n=this.resolutions_[o]/this.resolutions_[o+1];this.zoomFactor_=n,this.maxZoom=this.resolutions_.length-1,this.origin_=void 0!==t.origin?t.origin:null,this.origins_=null,void 0!==t.origins&&(this.origins_=t.origins,G(this.origins_.length==this.resolutions_.length,20));var s=t.extent;void 0===s||this.origin_||this.origins_||(this.origin_=j(s)),G(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,void 0!==t.tileSizes&&(this.tileSizes_=t.tileSizes,G(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=void 0!==t.tileSize?t.tileSize:this.tileSizes_?null:256,G(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=void 0!==s?s:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],void 0!==t.sizes?this.fullTileRanges_=t.sizes.map((function(t,e){var r=new Ot(Math.min(0,t[0]),Math.max(t[0]-1,-1),Math.min(0,t[1]),Math.max(t[1]-1,-1));if(s){var n=this.getTileRangeForExtentAndZ(s,e);r.minX=Math.max(n.minX,r.minX),r.maxX=Math.min(n.maxX,r.maxX),r.minY=Math.max(n.minY,r.minY),r.maxY=Math.min(n.maxY,r.maxY)}return r}),this):s&&this.calculateTileRanges_(s)}return t.prototype.forEachTileCoord=function(t,e,r){for(var n=this.getTileRangeForExtentAndZ(t,e),o=n.minX,i=n.maxX;o<=i;++o)for(var s=n.minY,a=n.maxY;s<=a;++s)r([e,o,s])},t.prototype.forEachTileCoordParentTileRange=function(t,e,r,n){var o,i,s=null,a=t[0]-1;for(2===this.zoomFactor_?(o=t[1],i=t[2]):s=this.getTileCoordExtent(t,n);a>=this.minZoom;){if(e(a,2===this.zoomFactor_?Pt(o=Math.floor(o/2),o,i=Math.floor(i/2),i,r):this.getTileRangeForExtentAndZ(s,a,r)))return!0;--a}return!1},t.prototype.getExtent=function(){return this.extent_},t.prototype.getMaxZoom=function(){return this.maxZoom},t.prototype.getMinZoom=function(){return this.minZoom},t.prototype.getOrigin=function(t){return this.origin_?this.origin_:this.origins_[t]},t.prototype.getResolution=function(t){return this.resolutions_[t]},t.prototype.getResolutions=function(){return this.resolutions_},t.prototype.getTileCoordChildTileRange=function(t,e,r){if(t[0]<this.maxZoom){if(2===this.zoomFactor_){var n=2*t[1],o=2*t[2];return Pt(n,n+1,o,o+1,e)}var i=this.getTileCoordExtent(t,r||this.tmpExtent_);return this.getTileRangeForExtentAndZ(i,t[0]+1,e)}return null},t.prototype.getTileRangeForTileCoordAndZ=function(t,e,r){if(e>this.maxZoom||e<this.minZoom)return null;var n=t[0],o=t[1],i=t[2];if(e===n)return Pt(o,i,o,i,r);if(this.zoomFactor_){var s=Math.pow(this.zoomFactor_,e-n),a=Math.floor(o*s),u=Math.floor(i*s);return e<n?Pt(a,a,u,u,r):Pt(a,Math.floor(s*(o+1))-1,u,Math.floor(s*(i+1))-1,r)}var l=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(l,e,r)},t.prototype.getTileRangeExtent=function(t,e,r){var n=this.getOrigin(t),o=this.getResolution(t),i=Lt(this.getTileSize(t),this.tmpSize_),s=n[0]+e.minX*i[0]*o,a=n[0]+(e.maxX+1)*i[0]*o;return M(s,n[1]+e.minY*i[1]*o,a,n[1]+(e.maxY+1)*i[1]*o,r)},t.prototype.getTileRangeForExtentAndZ=function(t,e,r){var n=Gt;this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,n);var o=n[1],i=n[2];return this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,n),Pt(o,n[1],i,n[2],r)},t.prototype.getTileCoordCenter=function(t){var e=this.getOrigin(t[0]),r=this.getResolution(t[0]),n=Lt(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*n[0]*r,e[1]-(t[2]+.5)*n[1]*r]},t.prototype.getTileCoordExtent=function(t,e){var r=this.getOrigin(t[0]),n=this.getResolution(t[0]),o=Lt(this.getTileSize(t[0]),this.tmpSize_),i=r[0]+t[1]*o[0]*n,s=r[1]-(t[2]+1)*o[1]*n;return M(i,s,i+o[0]*n,s+o[1]*n,e)},t.prototype.getTileCoordForCoordAndResolution=function(t,e,r){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,r)},t.prototype.getTileCoordForXYAndResolution_=function(t,e,r,n,o){var i=this.getZForResolution(r),s=r/this.getResolution(i),a=this.getOrigin(i),u=Lt(this.getTileSize(i),this.tmpSize_),l=n?.5:0,c=n?.5:0,h=Math.floor((t-a[0])/r+l),p=Math.floor((a[1]-e)/r+c),f=s*h/u[0],d=s*p/u[1];return n?(f=Math.ceil(f)-1,d=Math.ceil(d)-1):(f=Math.floor(f),d=Math.floor(d)),Et(i,f,d,o)},t.prototype.getTileCoordForXYAndZ_=function(t,e,r,n,o){var i=this.getOrigin(r),s=this.getResolution(r),a=Lt(this.getTileSize(r),this.tmpSize_),u=n?.5:0,l=n?.5:0,c=Math.floor((t-i[0])/s+u),h=Math.floor((i[1]-e)/s+l),p=c/a[0],f=h/a[1];return n?(p=Math.ceil(p)-1,f=Math.ceil(f)-1):(p=Math.floor(p),f=Math.floor(f)),Et(r,p,f,o)},t.prototype.getTileCoordForCoordAndZ=function(t,e,r){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,r)},t.prototype.getTileCoordResolution=function(t){return this.resolutions_[t[0]]},t.prototype.getTileSize=function(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]},t.prototype.getFullTileRange=function(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null},t.prototype.getZForResolution=function(t,e){return s(function(t,e,r){var n=t.length;if(t[0]<=e)return 0;if(e<=t[n-1])return n-1;var o=void 0;if(r>0){for(o=1;o<n;++o)if(t[o]<e)return o-1}else if(r<0){for(o=1;o<n;++o)if(t[o]<=e)return o}else for(o=1;o<n;++o){if(t[o]==e)return o;if(t[o]<e)return"function"==typeof r?r(e,t[o-1],t[o])>0?o-1:o:t[o-1]-e<e-t[o]?o-1:o}return n-1}(this.resolutions_,t,e||0),this.minZoom,this.maxZoom)},t.prototype.calculateTileRanges_=function(t){for(var e=this.resolutions_.length,r=new Array(e),n=this.minZoom;n<e;++n)r[n]=this.getTileRangeForExtentAndZ(t,n);this.fullTileRanges_=r},t}();function Ft(t,e,r,n){for(var o=void 0!==e?e:42,i=I(t),s=X(t),a=Lt(void 0!==r?r:256),u=n>0?n:Math.max(s/a[0],i/a[1]),l=o+1,c=new Array(l),h=0;h<l;++h)c[h]=u/Math.pow(2,h);return c}function It(t){var e=(t=N(t)).getExtent();if(!e){var r=180*n[o.DEGREES]/t.getMetersPerUnit();e=M(-r,-r,r,r)}return e}var Ut=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),jt=function(t){function e(e){var r=t.call(this,{attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX})||this;r.on,r.once,r.un,r.opaque_=void 0!==e.opaque&&e.opaque,r.tilePixelRatio_=void 0!==e.tilePixelRatio?e.tilePixelRatio:1,r.tileGrid=void 0!==e.tileGrid?e.tileGrid:null;var n=e.tileGrid;return n&&Lt(n.getTileSize(n.getMinZoom()),[256,256]),r.tileCache=new St(e.cacheSize||0),r.tmpSize=[0,0],r.key_=e.key||"",r.tileOptions={transition:e.transition},r.zDirection=e.zDirection?e.zDirection:0,r}return Ut(e,t),e.prototype.canExpireCache=function(){return this.tileCache.canExpireCache()},e.prototype.expireCache=function(t,e){var r=this.getTileCacheForProjection(t);r&&r.expireCache(e)},e.prototype.forEachLoadedTile=function(t,e,r,n){var o=this.getTileCacheForProjection(t);if(!o)return!1;for(var i,s,a,u=!0,l=r.minX;l<=r.maxX;++l)for(var c=r.minY;c<=r.maxY;++c)s=bt(e,l,c),a=!1,o.containsKey(s)&&(a=2===(i=o.get(s)).getState())&&(a=!1!==n(i)),a||(u=!1);return u},e.prototype.getGutterForProjection=function(t){return 0},e.prototype.getKey=function(){return this.key_},e.prototype.setKey=function(t){this.key_!==t&&(this.key_=t,this.changed())},e.prototype.getOpaque=function(t){return this.opaque_},e.prototype.getResolutions=function(){return this.tileGrid.getResolutions()},e.prototype.getTile=function(t,e,r,n,o){return C()},e.prototype.getTileGrid=function(){return this.tileGrid},e.prototype.getTileGridForProjection=function(t){return this.tileGrid?this.tileGrid:function(t){var e=t.getDefaultTileGrid();return e||(e=function(t,e,r,n){return function(t,e,r,n){var o=Ft(t,void 0,r);return new Mt({extent:t,origin:F(t,"top-left"),resolutions:o,tileSize:r})}(It(t),0,void 0)}(t),t.setDefaultTileGrid(e)),e}(t)},e.prototype.getTileCacheForProjection=function(t){return G(function(t,e){if(t===e)return!0;var r=t.getUnits()===e.getUnits();return(t.getCode()===e.getCode()||Y(t,e)===z)&&r}(this.getProjection(),t),68),this.tileCache},e.prototype.getTilePixelRatio=function(t){return this.tilePixelRatio_},e.prototype.getTilePixelSize=function(t,e,r){var n,o,i,s=this.getTileGridForProjection(r),a=this.getTilePixelRatio(e),u=Lt(s.getTileSize(t),this.tmpSize);return 1==a?u:(n=u,o=a,void 0===(i=this.tmpSize)&&(i=[0,0]),i[0]=n[0]*o+.5|0,i[1]=n[1]*o+.5|0,i)},e.prototype.getTileCoordForTileUrlFunction=function(t,e){var r=void 0!==e?e:this.getProjection(),n=this.getTileGridForProjection(r);return this.getWrapX()&&r.isGlobal()&&(t=function(t,e,r){var n,o,i,s=e[0],a=t.getTileCoordCenter(e),u=It(r);if(n=u,o=(l=a)[0],i=l[1],n[0]<=o&&o<=n[2]&&n[1]<=i&&i<=n[3])return e;var l,c=X(u),h=Math.ceil((u[0]-a[0])/c);return a[0]+=c*h,t.getTileCoordForCoordAndZ(a,s)}(n,t,r)),function(t,e){var r=t[0],n=t[1],o=t[2];if(e.getMinZoom()>r||r>e.getMaxZoom())return!1;var i=e.getFullTileRange(r);return!i||i.containsXY(n,o)}(t,n)?t:null},e.prototype.clear=function(){this.tileCache.clear()},e.prototype.refresh=function(){this.clear(),t.prototype.refresh.call(this)},e.prototype.updateCacheSize=function(t,e){var r=this.getTileCacheForProjection(e);t>r.highWaterMark&&(r.highWaterMark=t)},e.prototype.useTile=function(t,e,r,n){},e}(xt),Xt=function(t){function e(e,r){var n=t.call(this,e)||this;return n.tile=r,n}return Ut(e,t),e}($);const zt=jt;var Dt=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const Bt=function(t){function e(e){var r,n,o,i=this,s=void 0===e.projection?"EPSG:3857":e.projection,a=e.tileGrid;return void 0===a&&s&&(o={extent:n=(r={extent:It(s),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize}||{}).extent||N("EPSG:3857").getExtent(),minZoom:r.minZoom,tileSize:r.tileSize,resolutions:Ft(n,r.maxZoom,r.tileSize,r.maxResolution)},a=new Mt(o)),(i=t.call(this,{cacheSize:.1,projection:s,tileGrid:a,opaque:e.opaque,state:e.state,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition})||this).tileLoadingKeys_={},i.loader_=e.loader,i.handleTileChange_=i.handleTileChange_.bind(i),i.bandCount=void 0===e.bandCount?4:e.bandCount,i}return Dt(e,t),e.prototype.setLoader=function(t){this.loader_=t},e.prototype.getTile=function(t,e,r,n,o){var i=bt(t,e,r);if(this.tileCache.containsKey(i))return this.tileCache.get(i);var s=this.loader_,a=new at(Q({tileCoord:[t,e,r],loader:function(){return s(t,e,r)}},this.tileOptions));return a.key=this.getKey(),a.addEventListener(nt,this.handleTileChange_),this.tileCache.set(i,a),a},e.prototype.handleTileChange_=function(t){var e,r=t.target,n=O(r),o=r.getState();1==o?(this.tileLoadingKeys_[n]=!0,e="tileloadstart"):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],e=3==o?"tileloaderror":2==o?"tileloadend":void 0),e&&this.dispatchEvent(new Xt(e,r))},e}(zt),Nt="opacity",Zt="visible",Yt="extent",kt="zIndex",Wt="maxResolution",Vt="minResolution",Kt="maxZoom",Ht="minZoom",qt="source";var $t=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const Jt=function(t){function e(e){var r=t.call(this)||this;r.on,r.once,r.un;var n=Q({},e);return"object"==typeof e.properties&&(delete n.properties,Q(n,e.properties)),n.opacity=void 0!==e.opacity?e.opacity:1,G("number"==typeof n.opacity,64),n.visible=void 0===e.visible||e.visible,n.zIndex=e.zIndex,n.maxResolution=void 0!==e.maxResolution?e.maxResolution:1/0,n.minResolution=void 0!==e.minResolution?e.minResolution:0,n.minZoom=void 0!==e.minZoom?e.minZoom:-1/0,n.maxZoom=void 0!==e.maxZoom?e.maxZoom:1/0,r.className_=void 0!==n.className?e.className:"ol-layer",delete n.className,r.setProperties(n),r.state_=null,r}return $t(e,t),e.prototype.getClassName=function(){return this.className_},e.prototype.getLayerState=function(t){var e=this.state_||{layer:this,managed:void 0===t||t},r=this.getZIndex();return e.opacity=s(Math.round(100*this.getOpacity())/100,0,1),e.sourceState=this.getSourceState(),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=void 0!==r||e.managed?r:1/0,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),e.minZoom=this.getMinZoom(),e.maxZoom=this.getMaxZoom(),this.state_=e,e},e.prototype.getLayersArray=function(t){return C()},e.prototype.getLayerStatesArray=function(t){return C()},e.prototype.getExtent=function(){return this.get(Yt)},e.prototype.getMaxResolution=function(){return this.get(Wt)},e.prototype.getMinResolution=function(){return this.get(Vt)},e.prototype.getMinZoom=function(){return this.get(Ht)},e.prototype.getMaxZoom=function(){return this.get(Kt)},e.prototype.getOpacity=function(){return this.get(Nt)},e.prototype.getSourceState=function(){return C()},e.prototype.getVisible=function(){return this.get(Zt)},e.prototype.getZIndex=function(){return this.get(kt)},e.prototype.setExtent=function(t){this.set(Yt,t)},e.prototype.setMaxResolution=function(t){this.set(Wt,t)},e.prototype.setMinResolution=function(t){this.set(Vt,t)},e.prototype.setMaxZoom=function(t){this.set(Kt,t)},e.prototype.setMinZoom=function(t){this.set(Ht,t)},e.prototype.setOpacity=function(t){G("number"==typeof t,64),this.set(Nt,t)},e.prototype.setVisible=function(t){this.set(Zt,t)},e.prototype.setZIndex=function(t){this.set(kt,t)},e.prototype.disposeInternal=function(){this.state_&&(this.state_.layer=null,this.state_=null),t.prototype.disposeInternal.call(this)},e}(_t);var Qt=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const te=function(t){function e(e){var r=this,n=Q({},e);delete n.source,(r=t.call(this,n)||this).on,r.once,r.un,r.mapPrecomposeKey_=null,r.mapRenderKey_=null,r.sourceChangeKey_=null,r.renderer_=null,e.render&&(r.render=e.render),e.map&&r.setMap(e.map),r.addChangeListener(qt,r.handleSourcePropertyChange_);var o=e.source?e.source:null;return r.setSource(o),r}return Qt(e,t),e.prototype.getLayersArray=function(t){var e=t||[];return e.push(this),e},e.prototype.getLayerStatesArray=function(t){var e=t||[];return e.push(this.getLayerState()),e},e.prototype.getSource=function(){return this.get(qt)||null},e.prototype.getSourceState=function(){var t=this.getSource();return t?t.getState():"undefined"},e.prototype.handleSourceChange_=function(){this.changed()},e.prototype.handleSourcePropertyChange_=function(){this.sourceChangeKey_&&(ct(this.sourceChangeKey_),this.sourceChangeKey_=null);var t=this.getSource();t&&(this.sourceChangeKey_=ut(t,nt,this.handleSourceChange_,this)),this.changed()},e.prototype.getFeatures=function(t){return this.renderer_?this.renderer_.getFeatures(t):new Promise((function(t){return t([])}))},e.prototype.render=function(t,e){var r=this.getRenderer();if(r.prepareFrame(t))return r.renderFrame(t,e)},e.prototype.setMap=function(t){this.mapPrecomposeKey_&&(ct(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(ct(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=ut(t,"precompose",(function(t){var e=t.frameState.layerStatesArray,r=this.getLayerState(!1);G(!e.some((function(t){return t.layer===r.layer})),67),e.push(r)}),this),this.mapRenderKey_=ut(this,nt,t.render,t),this.changed())},e.prototype.setSource=function(t){this.set(qt,t)},e.prototype.getRenderer=function(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_},e.prototype.hasRenderer=function(){return!!this.renderer_},e.prototype.createRenderer=function(){return null},e.prototype.disposeInternal=function(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),t.prototype.disposeInternal.call(this)},e}(Jt),ee="preload",re="useInterimTilesOnError";var ne=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const oe=function(t){function e(e){var r=this,n=e||{},o=Q({},n);return delete o.preload,delete o.useInterimTilesOnError,(r=t.call(this,o)||this).on,r.once,r.un,r.setPreload(void 0!==n.preload?n.preload:0),r.setUseInterimTilesOnError(void 0===n.useInterimTilesOnError||n.useInterimTilesOnError),r}return ne(e,t),e.prototype.getPreload=function(){return this.get(ee)},e.prototype.setPreload=function(t){this.set(ee,t)},e.prototype.getUseInterimTilesOnError=function(){return this.get(re)},e.prototype.setUseInterimTilesOnError=function(t){this.set(re,t)},e}(te);var ie="undefined"!=typeof navigator&&void 0!==navigator.userAgent?navigator.userAgent.toLowerCase():"",se=(ie.indexOf("firefox"),-1!==ie.indexOf("safari")&&ie.indexOf("chrom"),-1!==ie.indexOf("webkit")&&ie.indexOf("edge"),ie.indexOf("macintosh"),"undefined"!=typeof devicePixelRatio&&devicePixelRatio,"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof OffscreenCanvas&&self instanceof WorkerGlobalScope),ae="undefined"!=typeof Image&&Image.prototype.decode;!function(){try{var t=Object.defineProperty({},"passive",{get:function(){!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch(t){}}();var ue=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const le=function(t){function e(e,r,n,o){var i=t.call(this)||this;return i.extent=e,i.pixelRatio_=n,i.resolution=r,i.state=o,i}return ue(e,t),e.prototype.changed=function(){this.dispatchEvent(nt)},e.prototype.getExtent=function(){return this.extent},e.prototype.getImage=function(){return C()},e.prototype.getPixelRatio=function(){return this.pixelRatio_},e.prototype.getResolution=function(){return this.resolution},e.prototype.getState=function(){return this.state},e.prototype.load=function(){C()},e}(rt);var ce=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();function he(t,e,r){var n=t;if(n.src&&ae){var o=n.decode(),i=!0;return o.then((function(){i&&e()})).catch((function(t){i&&("EncodingError"===t.name&&"Invalid image type."===t.message?e():r())})),function(){i=!1}}var s=[lt(n,"load",e),lt(n,"error",r)];return function(){s.forEach(ct)}}!function(t){function e(e,r,n,o,i,s){var a=t.call(this,e,r,n,0)||this;return a.src_=o,a.image_=new Image,null!==i&&(a.image_.crossOrigin=i),a.unlisten_=null,a.state=0,a.imageLoadFunction_=s,a}ce(e,t),e.prototype.getImage=function(){return this.image_},e.prototype.handleImageError_=function(){this.state=3,this.unlistenImage_(),this.changed()},e.prototype.handleImageLoad_=function(){void 0===this.resolution&&(this.resolution=I(this.extent)/this.image_.height),this.state=2,this.unlistenImage_(),this.changed()},e.prototype.load=function(){0!=this.state&&3!=this.state||(this.state=1,this.changed(),this.imageLoadFunction_(this,this.src_),this.unlisten_=he(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))},e.prototype.setImage=function(t){this.image_=t,this.resolution=I(this.extent)/this.image_.height},e.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}(le);var pe=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const fe=function(t){function e(e,r,n,o,i,s){var a=t.call(this,e,r,s)||this;return a.crossOrigin_=o,a.src_=n,a.key=n,a.image_=new Image,null!==o&&(a.image_.crossOrigin=o),a.unlisten_=null,a.tileLoadFunction_=i,a}return pe(e,t),e.prototype.getImage=function(){return this.image_},e.prototype.setImage=function(t){this.image_=t,this.state=2,this.unlistenImage_(),this.changed()},e.prototype.handleImageError_=function(){var t,e;this.state=3,this.unlistenImage_(),this.image_=(1,1,se?e=new OffscreenCanvas(1,1):(e=document.createElement("canvas")).style.all="unset",e.width=1,e.height=1,(t=e.getContext("2d",undefined)).fillStyle="rgba(0,0,0,0)",t.fillRect(0,0,1,1),t.canvas),this.changed()},e.prototype.handleImageLoad_=function(){var t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=2:this.state=4,this.unlistenImage_(),this.changed()},e.prototype.load=function(){3==this.state&&(this.state=0,this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)),0==this.state&&(this.state=1,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=he(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))},e.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},e}(it);var de=34962,ge=34963,_e=35044,ye=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function ve(t){switch(t){case de:return Float32Array;case ge:return Uint32Array;default:return Float32Array}}const me=function(){function t(t,e){this.array=null,this.type=t,G(t===de||t===ge,62),this.usage=void 0!==e?e:35044}return t.prototype.ofSize=function(t){this.array=new(ve(this.type))(t)},t.prototype.fromArray=function(t){var e=ve(this.type);this.array=e.from?e.from(t):new e(t)},t.prototype.fromArrayBuffer=function(t){this.array=new(ve(this.type))(t)},t.prototype.getType=function(){return this.type},t.prototype.getArray=function(){return this.array},t.prototype.getUsage=function(){return this.usage},t.prototype.getSize=function(){return this.array?this.array.length:0},t}();var xe=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();function Te(t,e){t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR)}function Ee(t,e,r,n,o){var i,s,a=t.getGL();switch(Te(a,e),o){case 1:i=a.LUMINANCE;break;case 2:i=a.LUMINANCE_ALPHA;break;case 3:i=a.RGB;break;case 4:i=a.RGBA;break;default:throw new Error("Unsupported number of bands: "+o)}r instanceof Float32Array?(s=a.FLOAT,t.getExtension("OES_texture_float"),t.getExtension("OES_texture_float_linear")):s=a.UNSIGNED_BYTE,a.texImage2D(a.TEXTURE_2D,0,i,n[0],n[1],0,i,s,r)}const be=function(t){function e(e,r,n){var o=t.call(this)||this;o.tile,o.textures=[],o.handleTileChange_=o.handleTileChange_.bind(o),o.size=Lt(r.getTileSize(e.tileCoord[0])),o.bandCount=NaN,o.helper_=n;var i=new me(de,_e);return i.fromArray([0,1,1,1,1,0,0,0]),n.flushBufferData(i),o.coords=i,o.setTile(e),o}return xe(e,t),e.prototype.setTile=function(t){t!==this.tile&&(this.tile&&this.tile.removeEventListener(nt,this.handleTileChange_),this.tile=t,this.textures.length=0,this.loaded=2===t.getState(),this.loaded?this.uploadTile_():t.addEventListener(nt,this.handleTileChange_))},e.prototype.uploadTile_=function(){var t=this.helper_,e=t.getGL(),r=this.tile;if(r instanceof fe){var n=e.createTexture();return this.textures.push(n),this.bandCount=4,void function(t,e,r){Te(t,e),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r)}(e,n,r.getImage())}var o=r.getData(),i=o instanceof Float32Array,s=this.size[0]*this.size[1];this.bandCount=o.byteLength/(i?4:1)/s;var a=Math.ceil(this.bandCount/4);if(1===a)return n=e.createTexture(),this.textures.push(n),void Ee(t,n,o,this.size,this.bandCount);for(var u=i?Float32Array:Uint8Array,l=new Array(a),c=0;c<a;++c){n=e.createTexture(),this.textures.push(n);var h=c<a-1?4:this.bandCount%4;l[c]=new u(s*h)}for(var p=s*this.bandCount,f=0;f<p;++f){var d=f%this.bandCount,g=d%4,_=(h=(c=Math.floor(d/4))<a-1?4:this.bandCount%4,Math.floor(f/this.bandCount));l[c][_*h+g]=o[f]}for(c=0;c<a;++c)h=c<a-1?4:this.bandCount%4,Ee(t,n=this.textures[c],l[c],this.size,h)},e.prototype.handleTileChange_=function(){2===this.tile.getState()&&(this.loaded=!0,this.uploadTile_(),this.dispatchEvent(nt))},e.prototype.disposeInternal=function(){var t=this.helper_.getGL();this.helper_.deleteBuffer(this.coords);for(var e=0;e<this.textures.length;++e)t.deleteTexture(this.textures[e]);this.tile.removeEventListener(nt,this.handleTileChange_)},e}(rt);var we=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const Re=function(t){function e(e){var r=t.call(this)||this;return r.boundHandleImageChange_=r.handleImageChange_.bind(r),r.layer_=e,r.declutterExecutorGroup=null,r}return we(e,t),e.prototype.getFeatures=function(t){return C()},e.prototype.prepareFrame=function(t){return C()},e.prototype.renderFrame=function(t,e){return C()},e.prototype.loadedTileCallback=function(t,e,r){t[e]||(t[e]={}),t[e][r.tileCoord.toString()]=r},e.prototype.createLoadedTileFinder=function(t,e,r){return function(n,o){var i=this.loadedTileCallback.bind(this,r,n);return t.forEachLoadedTile(e,n,o,i)}.bind(this)},e.prototype.forEachFeatureAtCoordinate=function(t,e,r,n,o){},e.prototype.getDataAtPixel=function(t,e,r){return null},e.prototype.getLayer=function(){return this.layer_},e.prototype.handleFontsChanged=function(){},e.prototype.handleImageChange_=function(t){2===t.target.getState()&&this.renderIfReadyAndVisible()},e.prototype.loadImage=function(t){var e=t.getState();return 2!=e&&3!=e&&t.addEventListener(nt,this.boundHandleImageChange_),0==e&&(t.load(),e=t.getState()),2==e},e.prototype.renderIfReadyAndVisible=function(){var t=this.getLayer();t.getVisible()&&t.getSourceState()==yt&&t.changed()},e}(ft);var Se=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const Ce=function(t){function e(e,r,n,o){var i=t.call(this,e)||this;return i.inversePixelTransform=r,i.frameState=n,i.context=o,i}return Se(e,t),e}($),Pe="webglcontextlost",Oe="webglcontextrestored",Ae=function(){function t(t){this.gl_=t.webGlContext;var e=this.gl_;this.scaleRatio_=t.scaleRatio||1,this.renderTargetTexture_=e.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=e.createFramebuffer();var r=e.createShader(e.VERTEX_SHADER);e.shaderSource(r,t.vertexShader||"\n  precision mediump float;\n  \n  attribute vec2 a_position;\n  varying vec2 v_texCoord;\n  varying vec2 v_screenCoord;\n  \n  uniform vec2 u_screenSize;\n   \n  void main() {\n    v_texCoord = a_position * 0.5 + 0.5;\n    v_screenCoord = v_texCoord * u_screenSize;\n    gl_Position = vec4(a_position, 0.0, 1.0);\n  }\n"),e.compileShader(r);var n=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(n,t.fragmentShader||"\n  precision mediump float;\n   \n  uniform sampler2D u_image;\n   \n  varying vec2 v_texCoord;\n   \n  void main() {\n    gl_FragColor = texture2D(u_image, v_texCoord);\n  }\n"),e.compileShader(n),this.renderTargetProgram_=e.createProgram(),e.attachShader(this.renderTargetProgram_,r),e.attachShader(this.renderTargetProgram_,n),e.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,-1,1,1,-1,1]),e.STATIC_DRAW),this.renderTargetAttribLocation_=e.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=e.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetTextureLocation_=e.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],t.uniforms&&Object.keys(t.uniforms).forEach(function(r){this.uniforms_.push({value:t.uniforms[r],location:e.getUniformLocation(this.renderTargetProgram_,r)})}.bind(this))}return t.prototype.getGL=function(){return this.gl_},t.prototype.init=function(t){var e=this.getGL(),r=[e.drawingBufferWidth*this.scaleRatio_,e.drawingBufferHeight*this.scaleRatio_];if(e.bindFramebuffer(e.FRAMEBUFFER,this.getFrameBuffer()),e.viewport(0,0,r[0],r[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==r[0]||this.renderTargetTextureSize_[1]!==r[1]){this.renderTargetTextureSize_=r;var n=e.RGBA,o=e.RGBA,i=e.UNSIGNED_BYTE;e.bindTexture(e.TEXTURE_2D,this.renderTargetTexture_),e.texImage2D(e.TEXTURE_2D,0,n,r[0],r[1],0,o,i,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.renderTargetTexture_,0)}},t.prototype.apply=function(t,e){var r=this.getGL(),n=t.size;r.bindFramebuffer(r.FRAMEBUFFER,e?e.getFrameBuffer():null),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,this.renderTargetTexture_),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT),r.enable(r.BLEND),r.blendFunc(r.ONE,r.ONE_MINUS_SRC_ALPHA),r.viewport(0,0,r.drawingBufferWidth,r.drawingBufferHeight),r.bindBuffer(r.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),r.useProgram(this.renderTargetProgram_),r.enableVertexAttribArray(this.renderTargetAttribLocation_),r.vertexAttribPointer(this.renderTargetAttribLocation_,2,r.FLOAT,!1,0,0),r.uniform2f(this.renderTargetUniformLocation_,n[0],n[1]),r.uniform1i(this.renderTargetTextureLocation_,0),this.applyUniforms(t),r.drawArrays(r.TRIANGLES,0,6)},t.prototype.getFrameBuffer=function(){return this.frameBuffer_},t.prototype.applyUniforms=function(t){var e,r=this.getGL(),n=1;this.uniforms_.forEach((function(o){if((e="function"==typeof o.value?o.value(t):o.value)instanceof HTMLCanvasElement||e instanceof ImageData)o.texture||(o.texture=r.createTexture()),r.activeTexture(r["TEXTURE"+n]),r.bindTexture(r.TEXTURE_2D,o.texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),e instanceof ImageData?r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,e.width,e.height,0,r.UNSIGNED_BYTE,new Uint8Array(e.data)):r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,e),r.uniform1i(o.location,n++);else if(Array.isArray(e))switch(e.length){case 2:return void r.uniform2f(o.location,e[0],e[1]);case 3:return void r.uniform3f(o.location,e[0],e[1],e[2]);case 4:return void r.uniform4f(o.location,e[0],e[1],e[2],e[3]);default:return}else"number"==typeof e&&r.uniform1f(o.location,e)}))},t}();var Le=new Array(6);function Ge(t){return Fe(t,1,0,0,1,0,0)}function Me(t,e){var r=t[0],n=t[1],o=t[2],i=t[3],s=t[4],a=t[5],u=e[0],l=e[1],c=e[2],h=e[3],p=e[4],f=e[5];return t[0]=r*u+o*l,t[1]=n*u+i*l,t[2]=r*c+o*h,t[3]=n*c+i*h,t[4]=r*p+o*f+s,t[5]=n*p+i*f+a,t}function Fe(t,e,r,n,o,i,s){return t[0]=e,t[1]=r,t[2]=n,t[3]=o,t[4]=i,t[5]=s,t}function Ie(t,e,r,n,o,i,s,a){var u=Math.sin(i),l=Math.cos(i);return t[0]=n*l,t[1]=o*u,t[2]=-n*u,t[3]=o*l,t[4]=s*n*l-a*n*u+e,t[5]=s*o*u+a*o*l+r,t}function Ue(t,e){return t[0]=e[0],t[1]=e[1],t[4]=e[2],t[5]=e[3],t[12]=e[4],t[13]=e[5],t}var je=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Xe=function(t){function e(e){var r=t.call(this)||this,n=e||{};r.boundHandleWebGLContextLost_=r.handleWebGLContextLost.bind(r),r.boundHandleWebGLContextRestored_=r.handleWebGLContextRestored.bind(r),r.canvas_=document.createElement("canvas"),r.canvas_.style.position="absolute",r.canvas_.style.left="0",r.gl_=function(t,e){for(var r=ye.length,n=0;n<r;++n)try{var o=t.getContext(ye[n],e);if(o)return o}catch(t){}return null}(r.canvas_);var o=r.getGL();if(r.bufferCache_={},r.extensionCache_={},r.currentProgram_=null,r.canvas_.addEventListener(Pe,r.boundHandleWebGLContextLost_),r.canvas_.addEventListener(Oe,r.boundHandleWebGLContextRestored_),r.offsetRotateMatrix_=[1,0,0,1,0,0],r.offsetScaleMatrix_=[1,0,0,1,0,0],r.tmpMat4_=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],r.uniformLocations_={},r.attribLocations_={},r.uniforms_=[],n.uniforms)for(var i in n.uniforms)r.uniforms_.push({name:i,value:n.uniforms[i]});return r.postProcessPasses_=n.postProcesses?n.postProcesses.map((function(t){return new Ae({webGlContext:o,scaleRatio:t.scaleRatio,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms})})):[new Ae({webGlContext:o})],r.shaderCompileErrors_=null,r.startTime_=Date.now(),r}return je(e,t),e.prototype.getExtension=function(t){if(t in this.extensionCache_)return this.extensionCache_[t];var e=this.gl_.getExtension(t);return this.extensionCache_[t]=e,e},e.prototype.bindBuffer=function(t){var e=this.getGL(),r=O(t),n=this.bufferCache_[r];n||(n={buffer:t,webGlBuffer:e.createBuffer()},this.bufferCache_[r]=n),e.bindBuffer(t.getType(),n.webGlBuffer)},e.prototype.flushBufferData=function(t){var e=this.getGL();this.bindBuffer(t),e.bufferData(t.getType(),t.getArray(),t.getUsage())},e.prototype.deleteBuffer=function(t){var e=this.getGL(),r=O(t),n=this.bufferCache_[r];n&&!e.isContextLost()&&e.deleteBuffer(n.webGlBuffer),delete this.bufferCache_[r]},e.prototype.disposeInternal=function(){this.canvas_.removeEventListener(Pe,this.boundHandleWebGLContextLost_),this.canvas_.removeEventListener(Oe,this.boundHandleWebGLContextRestored_);var t=this.gl_.getExtension("WEBGL_lose_context");t&&t.loseContext(),delete this.gl_,delete this.canvas_},e.prototype.prepareDraw=function(t,e){var r=this.getGL(),n=this.getCanvas(),o=t.size,i=t.pixelRatio;n.width=o[0]*i,n.height=o[1]*i,n.style.width=o[0]+"px",n.style.height=o[1]+"px",r.useProgram(this.currentProgram_);for(var s=this.postProcessPasses_.length-1;s>=0;s--)this.postProcessPasses_[s].init(t);r.bindTexture(r.TEXTURE_2D,null),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT),r.enable(r.BLEND),r.blendFunc(r.ONE,e?r.ZERO:r.ONE_MINUS_SRC_ALPHA),r.useProgram(this.currentProgram_),this.applyFrameState(t),this.applyUniforms(t)},e.prototype.prepareDrawToRenderTarget=function(t,e,r){var n=this.getGL(),o=e.getSize();n.bindFramebuffer(n.FRAMEBUFFER,e.getFramebuffer()),n.viewport(0,0,o[0],o[1]),n.bindTexture(n.TEXTURE_2D,e.getTexture()),n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),n.enable(n.BLEND),n.blendFunc(n.ONE,r?n.ZERO:n.ONE_MINUS_SRC_ALPHA),n.useProgram(this.currentProgram_),this.applyFrameState(t),this.applyUniforms(t)},e.prototype.drawElements=function(t,e){var r=this.getGL();this.getExtension("OES_element_index_uint");var n=r.UNSIGNED_INT,o=e-t,i=4*t;r.drawElements(r.TRIANGLES,o,n,i)},e.prototype.finalizeDraw=function(t){for(var e=0;e<this.postProcessPasses_.length;e++)this.postProcessPasses_[e].apply(t,this.postProcessPasses_[e+1]||null)},e.prototype.getCanvas=function(){return this.canvas_},e.prototype.getGL=function(){return this.gl_},e.prototype.applyFrameState=function(t){var e=t.size,r=t.viewState.rotation,n=Ge(this.offsetScaleMatrix_);!function(t,e,r){Me(t,Fe(Le,e,0,0,r,0,0))}(n,2/e[0],2/e[1]);var o=Ge(this.offsetRotateMatrix_);0!==r&&function(t,e){var r=Math.cos(e),n=Math.sin(e);Me(t,Fe(Le,r,n,-n,r,0,0))}(o,-r),this.setUniformMatrixValue("u_offsetScaleMatrix",Ue(this.tmpMat4_,n)),this.setUniformMatrixValue("u_offsetRotateMatrix",Ue(this.tmpMat4_,o)),this.setUniformFloatValue("u_time",.001*(Date.now()-this.startTime_)),this.setUniformFloatValue("u_zoom",t.viewState.zoom),this.setUniformFloatValue("u_resolution",t.viewState.resolution)},e.prototype.applyUniforms=function(t){var e,r=this.getGL(),n=0;this.uniforms_.forEach(function(o){if((e="function"==typeof o.value?o.value(t):o.value)instanceof HTMLCanvasElement||e instanceof HTMLImageElement||e instanceof ImageData)o.texture||(o.prevValue=void 0,o.texture=r.createTexture()),r.activeTexture(r["TEXTURE"+n]),r.bindTexture(r.TEXTURE_2D,o.texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),(!(e instanceof HTMLImageElement)||e.complete)&&o.prevValue!==e&&(o.prevValue=e,r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,e)),r.uniform1i(this.getUniformLocation(o.name),n++);else if(Array.isArray(e)&&6===e.length)this.setUniformMatrixValue(o.name,Ue(this.tmpMat4_,e));else if(Array.isArray(e)&&e.length<=4)switch(e.length){case 2:return void r.uniform2f(this.getUniformLocation(o.name),e[0],e[1]);case 3:return void r.uniform3f(this.getUniformLocation(o.name),e[0],e[1],e[2]);case 4:return void r.uniform4f(this.getUniformLocation(o.name),e[0],e[1],e[2],e[3]);default:return}else"number"==typeof e&&r.uniform1f(this.getUniformLocation(o.name),e)}.bind(this))},e.prototype.useProgram=function(t){return t!=this.currentProgram_&&(this.getGL().useProgram(t),this.currentProgram_=t,this.uniformLocations_={},this.attribLocations_={},!0)},e.prototype.compileShader=function(t,e){var r=this.getGL(),n=r.createShader(e);return r.shaderSource(n,t),r.compileShader(n),n},e.prototype.getProgram=function(t,e){var r=this.getGL(),n=this.compileShader(t,r.FRAGMENT_SHADER),o=this.compileShader(e,r.VERTEX_SHADER),i=r.createProgram();if(r.attachShader(i,n),r.attachShader(i,o),r.linkProgram(i),!r.getShaderParameter(n,r.COMPILE_STATUS)){var s="Fragment shader compliation failed: "+r.getShaderInfoLog(n);throw new Error(s)}if(r.deleteShader(n),!r.getShaderParameter(o,r.COMPILE_STATUS))throw s="Vertex shader compilation failed: "+r.getShaderInfoLog(o),new Error(s);if(r.deleteShader(o),!r.getProgramParameter(i,r.LINK_STATUS))throw s="GL program linking failed: "+r.getShaderInfoLog(o),new Error(s);return i},e.prototype.getUniformLocation=function(t){return void 0===this.uniformLocations_[t]&&(this.uniformLocations_[t]=this.getGL().getUniformLocation(this.currentProgram_,t)),this.uniformLocations_[t]},e.prototype.getAttributeLocation=function(t){return void 0===this.attribLocations_[t]&&(this.attribLocations_[t]=this.getGL().getAttribLocation(this.currentProgram_,t)),this.attribLocations_[t]},e.prototype.makeProjectionTransform=function(t,e){var r=t.size,n=t.viewState.rotation,o=t.viewState.resolution,i=t.viewState.center;return Ge(e),Ie(e,0,0,2/(o*r[0]),2/(o*r[1]),-n,-i[0],-i[1]),e},e.prototype.setUniformFloatValue=function(t,e){this.getGL().uniform1f(this.getUniformLocation(t),e)},e.prototype.setUniformMatrixValue=function(t,e){this.getGL().uniformMatrix4fv(this.getUniformLocation(t),!1,e)},e.prototype.enableAttributeArray_=function(t,e,r,n,o){var i=this.getAttributeLocation(t);i<0||(this.getGL().enableVertexAttribArray(i),this.getGL().vertexAttribPointer(i,e,r,!1,n,o))},e.prototype.enableAttributes=function(t){for(var e=function(t){for(var e=0,r=0;r<t.length;r++){var n=t[r];e+=n.size*ze(n.type)}return e}(t),r=0,n=0;n<t.length;n++){var o=t[n];this.enableAttributeArray_(o.name,o.size,o.type||5126,e,r),r+=o.size*ze(o.type)}},e.prototype.handleWebGLContextLost=function(){tt(this.bufferCache_),this.currentProgram_=null},e.prototype.handleWebGLContextRestored=function(){},e.prototype.createTexture=function(t,e,r){var n=this.getGL(),o=r||n.createTexture(),i=n.RGBA,s=n.RGBA,a=n.UNSIGNED_BYTE;return n.bindTexture(n.TEXTURE_2D,o),e?n.texImage2D(n.TEXTURE_2D,0,i,s,a,e):n.texImage2D(n.TEXTURE_2D,0,i,t[0],t[1],0,s,a,null),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),o},e}(q);function ze(t){switch(t){case 5121:return Uint8Array.BYTES_PER_ELEMENT;case 5123:return Uint16Array.BYTES_PER_ELEMENT;case 5125:return Uint32Array.BYTES_PER_ELEMENT;default:return Float32Array.BYTES_PER_ELEMENT}}const De=Xe;var Be=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const Ne=function(t){function e(e,r){var n=t.call(this,e)||this,o=r||{};return n.helper=new De({postProcesses:o.postProcesses,uniforms:o.uniforms}),void 0!==o.className&&(n.helper.getCanvas().className=o.className),n}return Be(e,t),e.prototype.disposeInternal=function(){this.helper.dispose(),delete this.helper,t.prototype.disposeInternal.call(this)},e.prototype.dispatchRenderEvent_=function(t,e){var r=this.getLayer();if(r.hasListener(t)){var n=new Ce(t,null,e,null);r.dispatchEvent(n)}},e.prototype.preRender=function(t){this.dispatchRenderEvent_("prerender",t)},e.prototype.postRender=function(t){this.dispatchRenderEvent_("postrender",t)},e}(Re);var Ze=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ye="u_tileTexture",ke="u_tileTransform",We="u_transitionAlpha",Ve="u_depth",Ke="u_texturePixelWidth",He="u_texturePixelHeight",qe="u_resolution",$e="u_zoom",Je="a_textureCoord",Qe=[{name:Je,size:2,type:5126}],tr={};function er(t){return 2*(1-1/(t+1))-1}function rr(t,e,r){r in t||(t[r]=[]),t[r].push(e)}function nr(t,e){var r=t.layerStatesArray[t.layerIndex];return r.extent&&(e=U(e,function(t,e){return t}(r.extent,t.viewState.projection))),e}var or=function(t){function e(e,r){var n=t.call(this,e,{uniforms:r.uniforms,className:r.className})||this;n.tileTransform_=[1,0,0,1,0,0],n.tempMat4_=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],n.tempTileRange_=new Ot(0,0,0,0),n.tempTileCoord_=Et(0,0,0),n.tempSize_=[0,0],n.program_=n.helper.getProgram(r.fragmentShader,r.vertexShader);var o=new me(ge,_e);o.fromArray([0,1,3,1,2,3]),n.helper.flushBufferData(o),n.indices_=o;var i=void 0!==r.cacheSize?r.cacheSize:512;return n.tileTextureCache_=new Tt(i),n.renderedOpacity_=NaN,n}return Ze(e,t),e.prototype.isDrawableTile=function(t){var e=this.getLayer(),r=t.getState(),n=e.getUseInterimTilesOnError();return 2==r||4==r||3==r&&!n},e.prototype.prepareFrame=function(t){if((e=nr(t,t.extent))[2]<e[0]||e[3]<e[1])return!1;var e,r=this.getLayer().getSource();return!!r&&r.getState()===yt},e.prototype.enqueueTiles=function(t,e,r,n){var o=t.viewState,i=this.getLayer().getSource(),s=i.getTileGridForProjection(o.projection),a=this.tileTextureCache_,u=s.getTileRangeForExtentAndZ(e,r),l=O(i);l in t.wantedTiles||(t.wantedTiles[l]={});for(var c=t.wantedTiles[l],h=s.getResolution(r),p=u.minX;p<=u.maxX;++p)for(var f=u.minY;f<=u.maxY;++f){var d=Et(r,p,f,this.tempTileCoord_),g=wt(d),_=void 0,y=void 0;a.containsKey(g)&&(y=(_=a.get(g)).tile),_&&_.tile.key===i.getKey()||(y=i.getTile(r,p,f,t.pixelRatio,o.projection),_?_.setTile(this.isDrawableTile(y)?y:y.getInterimTile()):(_=new be(y,s,this.helper),a.set(g,_))),rr(n,_,r);var v=y.getKey();c[v]=!0,0===y.getState()&&(t.tileQueue.isKeyQueued(v)||t.tileQueue.enqueue([y,l,s.getTileCoordCenter(d),h]))}},e.prototype.renderFrame=function(t){this.preRender(t);var e=t.viewState,r=t.layerStatesArray[t.layerIndex],n=nr(t,t.extent),o=this.getLayer().getSource(),i=o.getTileGridForProjection(e.projection),s=i.getZForResolution(e.resolution,o.zDirection),a={};if(t.nextExtent){var u=i.getZForResolution(e.nextResolution,o.zDirection),l=nr(t,t.nextExtent);this.enqueueTiles(t,l,u,a)}this.enqueueTiles(t,n,s,a);for(var c={},h=O(this),p=t.time,f=!1,d=a[s],g=0,_=d.length;g<_;++g){var y=(I=(W=d[g]).tile).tileCoord;if(W.loaded){if(1===(U=I.getAlpha(h,p))){I.endTransition(h);continue}f=!0,c[j=wt(y)]=U}if(!this.findAltTiles_(i,y,s+1,a))for(var v=s-1;v>=i.minZoom&&!this.findAltTiles_(i,y,v,a);--v);}this.helper.useProgram(this.program_),this.helper.prepareDraw(t,!f);for(var m=Object.keys(a).map(Number).sort(At),x=this.helper.getGL(),T=e.center[0],E=e.center[1],b=0,w=m.length;b<w;++b){var R=m[b],S=i.getResolution(R),C=Lt(i.getTileSize(R),this.tempSize_),P=i.getOrigin(R),A=(T-P[0])/(C[0]*S),L=(P[1]-E)/(C[1]*S),G=e.resolution/S,M=er(R),F=a[R];for(g=0,_=F.length;g<_;++g)if((W=F[g]).loaded){var I,U,j=wt(y=(I=W.tile).tileCoord),X=y[1],z=y[2];Ie(this.tileTransform_,0,0,2/(t.size[0]*G/C[0]),-2/(t.size[1]*G/C[1]),e.rotation,-(A-X),-(L-z)),this.helper.setUniformMatrixValue(ke,Ue(this.tempMat4_,this.tileTransform_)),this.helper.bindBuffer(W.coords),this.helper.bindBuffer(this.indices_),this.helper.enableAttributes(Qe);for(var D=0;D<W.textures.length;++D){var B="TEXTURE"+D,N=Ye+D;x.activeTexture(x[B]),x.bindTexture(x.TEXTURE_2D,W.textures[D]),x.uniform1i(this.helper.getUniformLocation(N),D)}(U=j in c?c[j]:1)<1&&(t.animate=!0),this.helper.setUniformFloatValue(We,U),this.helper.setUniformFloatValue(Ve,M),this.helper.setUniformFloatValue(Ke,C[0]),this.helper.setUniformFloatValue(He,C[1]),this.helper.setUniformFloatValue(qe,e.resolution),this.helper.setUniformFloatValue($e,e.zoom),this.helper.drawElements(0,this.indices_.getSize())}}this.helper.finalizeDraw(t);var Z=this.helper.getCanvas(),Y=r.opacity;this.renderedOpacity_!==Y&&(Z.style.opacity=String(Y),this.renderedOpacity_=Y);for(var k=this.tileTextureCache_;k.canExpireCache();){var W;(W=k.pop()).dispose()}return t.postRenderFunctions.push((function(t,e){o.expireCache(o.getProjection(),tr)})),this.postRender(t),Z},e.prototype.findAltTiles_=function(t,e,r,n){var o=t.getTileRangeForTileCoordAndZ(e,r,this.tempTileRange_);if(!o)return!1;for(var i=!0,s=this.tileTextureCache_,a=o.minX;a<=o.maxX;++a)for(var u=o.minY;u<=o.maxY;++u){var l=bt(r,a,u),c=!1;if(s.containsKey(l)){var h=s.get(l);h.loaded&&(rr(n,h,r),c=!0)}c||(i=!1)}return i},e.prototype.disposeInternal=function(){var e=this.helper,r=e.getGL();e.deleteBuffer(this.indices_),delete this.indices_,r.deleteProgram(this.program_),delete this.program_;var n=this.tileTextureCache_;n.forEach((function(t){t.dispose()})),n.clear(),delete this.tileTextureCache_,t.prototype.disposeInternal.call(this)},e}(Ne);or.prototype.getLayer;const ir=or;var sr=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,ar=/^([a-z]*)$|^hsla?\(.*\)$/i;function ur(t){var e=document.createElement("div");if(e.style.color=t,""!==e.style.color){document.body.appendChild(e);var r=getComputedStyle(e).color;return document.body.removeChild(e),r}return""}var lr=function(){var t={},e=0;return function(r){var n;if(t.hasOwnProperty(r))n=t[r];else{if(e>=1024){var o=0;for(var i in t)0==(3&o++)&&(delete t[i],--e)}n=function(t){var e,r,n,o,i;if(ar.exec(t)&&(t=ur(t)),sr.exec(t)){var s,a=t.length-1;s=a<=4?1:2;var u=4===a||8===a;e=parseInt(t.substr(1+0*s,s),16),r=parseInt(t.substr(1+1*s,s),16),n=parseInt(t.substr(1+2*s,s),16),o=u?parseInt(t.substr(1+3*s,s),16):255,1==s&&(e=(e<<4)+e,r=(r<<4)+r,n=(n<<4)+n,u&&(o=(o<<4)+o)),i=[e,r,n,o/255]}else 0==t.indexOf("rgba(")?cr(i=t.slice(5,-1).split(",").map(Number)):0==t.indexOf("rgb(")?((i=t.slice(4,-1).split(",").map(Number)).push(1),cr(i)):G(!1,14);return i}(r),t[r]=n,++e}return n}}();function cr(t){return t[0]=s(t[0]+.5|0,0,255),t[1]=s(t[1]+.5|0,0,255),t[2]=s(t[2]+.5|0,0,255),t[3]=s(t[3],0,1),t}var hr=31,pr={};function fr(t){if("number"==typeof t)return 1;if("boolean"==typeof t)return 8;if("string"==typeof t)return e=t,ar.test(e)&&(e=ur(e)),sr.test(e)||0===e.indexOf("rgba(")||0===e.indexOf("rgb(")?6:2;var e;if(!Array.isArray(t))throw new Error("Unhandled value type: "+JSON.stringify(t));var r=t;if(r.every((function(t){return"number"==typeof t})))return 3===r.length||4===r.length?20:16;if("string"!=typeof r[0])throw new Error("Expected an expression operator but received: "+JSON.stringify(r));var n=pr[r[0]];if(void 0===n)throw new Error("Unrecognized expression operator: "+JSON.stringify(r));return n.getReturnType(r.slice(1))}function dr(t){var e=t.toString();return-1===e.indexOf(".")?e+".0":e}function gr(t){if(t.length<2||t.length>4)throw new Error("`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.");return"vec"+t.length+"("+t.map(dr).join(", ")+")"}function _r(t,e){return void 0===t.stringLiteralsMap[e]&&(t.stringLiteralsMap[e]=Object.keys(t.stringLiteralsMap).length),t.stringLiteralsMap[e]}function yr(t,e,r){if(Array.isArray(e)&&"string"==typeof e[0]){var n=pr[e[0]];if(void 0===n)throw new Error("Unrecognized expression operator: "+JSON.stringify(e));return n.toGlsl(t,e.slice(1),r)}var o,i=fr(e);if((1&i)>0)return dr(e);if((8&i)>0)return e.toString();if((2&i)>0&&(void 0===r||2==r))return function(t,e){return dr(_r(t,e))}(t,e.toString());if((4&i)>0&&(void 0===r||4==r))return(o=function(t){return Array.isArray(t)?t:lr(t)}(e).slice()).length<4&&o.push(1),gr(o.map((function(t,e){return e<3?t/255:t})));if((16&i)>0)return gr(e);throw new Error("Unexpected expression "+e+" (expected type "+r+")")}function vr(t){if(!(1&fr(t)))throw new Error("A numeric value was expected, got "+JSON.stringify(t)+" instead")}function mr(t){for(var e=0;e<t.length;e++)vr(t[e])}function xr(t){if(!(2&fr(t)))throw new Error("A string value was expected, got "+JSON.stringify(t)+" instead")}function Tr(t){if(!(8&fr(t)))throw new Error("A boolean value was expected, got "+JSON.stringify(t)+" instead")}function Er(t,e){if(t.length!==e)throw new Error("Exactly "+e+" arguments were expected, got "+t.length+" instead")}function br(t,e){if(t.length<e)throw new Error("At least "+e+" arguments were expected, got "+t.length+" instead")}function wr(t,e){if(t.length>e)throw new Error("At most "+e+" arguments were expected, got "+t.length+" instead")}function Rr(t){if(t.length%2!=0)throw new Error("An even amount of arguments was expected, got "+t+" instead")}function Sr(t,e){if(l(e)%1!=0)throw new Error("Could not infer only one type from the following expression: "+JSON.stringify(t))}function Cr(t){return"u_var_"+t}function Pr(t){return{getReturnType:function(t){return 8},toGlsl:function(e,r){Er(r,2);for(var n=hr,o=0;o<r.length;o++)n&=fr(r[o]);if(0===n)throw new Error("All arguments should be of compatible type, got "+JSON.stringify(r)+" instead");return n&=-5,"("+yr(e,r[0],n)+" "+t+" "+yr(e,r[1],n)+")"}}}function Or(t){return{getReturnType:function(t){return 8},toGlsl:function(e,r){br(r,2);for(var n=0;n<r.length;n++)Tr(r[n]);return"("+r.map((function(t){return yr(e,t)})).join(" "+t+" ")+")"}}}pr.get={getReturnType:function(t){return hr},toGlsl:function(t,e){Er(e,1),xr(e[0]);var r=e[0].toString();return-1===t.attributes.indexOf(r)&&t.attributes.push(r),(t.inFragmentShader?"v_":"a_")+r}},pr.var={getReturnType:function(t){return hr},toGlsl:function(t,e){Er(e,1),xr(e[0]);var r=e[0].toString();return-1===t.variables.indexOf(r)&&t.variables.push(r),Cr(r)}},pr.band={getReturnType:function(t){return 1},toGlsl:function(t,e){br(e,1),wr(e,3);var r=e[0];if("number"!=typeof r)throw new Error("Band index must be a number");var n=r-1,o=Math.floor(n/4),i=n%4;if(r===t.bandCount&&1===i&&(i=3),1===e.length)return"color"+o+"["+i+"]";var s=e[1],a=e[2]||0;return vr(s),vr(a),"texture2D("+(Ye+o)+", v_textureCoord + vec2("+yr(t,s)+" / "+"u_texturePixelWidth, "+yr(t,a)+" / "+"u_texturePixelHeight))["+i+"]"}},pr.time={getReturnType:function(t){return 1},toGlsl:function(t,e){return Er(e,0),"u_time"}},pr.zoom={getReturnType:function(t){return 1},toGlsl:function(t,e){return Er(e,0),"u_zoom"}},pr.resolution={getReturnType:function(t){return 1},toGlsl:function(t,e){return Er(e,0),"u_resolution"}},pr["*"]={getReturnType:function(t){return 1},toGlsl:function(t,e){return Er(e,2),mr(e),"("+yr(t,e[0])+" * "+yr(t,e[1])+")"}},pr["/"]={getReturnType:function(t){return 1},toGlsl:function(t,e){return Er(e,2),mr(e),"("+yr(t,e[0])+" / "+yr(t,e[1])+")"}},pr["+"]={getReturnType:function(t){return 1},toGlsl:function(t,e){return Er(e,2),mr(e),"("+yr(t,e[0])+" + "+yr(t,e[1])+")"}},pr["-"]={getReturnType:function(t){return 1},toGlsl:function(t,e){return Er(e,2),mr(e),"("+yr(t,e[0])+" - "+yr(t,e[1])+")"}},pr.clamp={getReturnType:function(t){return 1},toGlsl:function(t,e){Er(e,3),mr(e);var r=yr(t,e[1]),n=yr(t,e[2]);return"clamp("+yr(t,e[0])+", "+r+", "+n+")"}},pr["%"]={getReturnType:function(t){return 1},toGlsl:function(t,e){return Er(e,2),mr(e),"mod("+yr(t,e[0])+", "+yr(t,e[1])+")"}},pr["^"]={getReturnType:function(t){return 1},toGlsl:function(t,e){return Er(e,2),mr(e),"pow("+yr(t,e[0])+", "+yr(t,e[1])+")"}},pr.abs={getReturnType:function(t){return 1},toGlsl:function(t,e){return Er(e,1),mr(e),"abs("+yr(t,e[0])+")"}},pr.sin={getReturnType:function(t){return 1},toGlsl:function(t,e){return Er(e,1),mr(e),"sin("+yr(t,e[0])+")"}},pr.cos={getReturnType:function(t){return 1},toGlsl:function(t,e){return Er(e,1),mr(e),"cos("+yr(t,e[0])+")"}},pr.atan={getReturnType:function(t){return 1},toGlsl:function(t,e){return br(e,1),wr(e,2),mr(e),2===e.length?"atan("+yr(t,e[0])+", "+yr(t,e[1])+")":"atan("+yr(t,e[0])+")"}},pr[">"]={getReturnType:function(t){return 8},toGlsl:function(t,e){return Er(e,2),mr(e),"("+yr(t,e[0])+" > "+yr(t,e[1])+")"}},pr[">="]={getReturnType:function(t){return 8},toGlsl:function(t,e){return Er(e,2),mr(e),"("+yr(t,e[0])+" >= "+yr(t,e[1])+")"}},pr["<"]={getReturnType:function(t){return 8},toGlsl:function(t,e){return Er(e,2),mr(e),"("+yr(t,e[0])+" < "+yr(t,e[1])+")"}},pr["<="]={getReturnType:function(t){return 8},toGlsl:function(t,e){return Er(e,2),mr(e),"("+yr(t,e[0])+" <= "+yr(t,e[1])+")"}},pr["=="]=Pr("=="),pr["!="]=Pr("!="),pr["!"]={getReturnType:function(t){return 8},toGlsl:function(t,e){return Er(e,1),Tr(e[0]),"(!"+yr(t,e[0])+")"}},pr.all=Or("&&"),pr.any=Or("||"),pr.between={getReturnType:function(t){return 8},toGlsl:function(t,e){Er(e,3),mr(e);var r=yr(t,e[1]),n=yr(t,e[2]),o=yr(t,e[0]);return"("+o+" >= "+r+" && "+o+" <= "+n+")"}},pr.array={getReturnType:function(t){return 16},toGlsl:function(t,e){br(e,2),wr(e,4),mr(e);var r=e.map((function(e){return yr(t,e,1)}));return"vec"+e.length+"("+r.join(", ")+")"}},pr.color={getReturnType:function(t){return 4},toGlsl:function(t,e){br(e,3),wr(e,4),mr(e);var r=e;3===e.length&&r.push(1);var n=e.map((function(e,r){return yr(t,e,1)+(r<3?" / 255.0":"")}));return"vec"+e.length+"("+n.join(", ")+")"}},pr.interpolate={getReturnType:function(t){for(var e=5,r=3;r<t.length;r+=2)e&=fr(t[r]);return e},toGlsl:function(t,e,r){Rr(e),br(e,6);var n,o=e[0];switch(o[0]){case"linear":n=1;break;case"exponential":n=o[1];break;default:n=null}if(!n)throw new Error('Invalid interpolation type for "interpolate" operator, received: '+JSON.stringify(o));var i=void 0!==r?r:hr,s=pr.interpolate.getReturnType(e)&i;Sr(e,s);for(var a=yr(t,e[1]),u=dr(n),l="",c=2;c<e.length-2;c+=2){var h=yr(t,e[c]),p=l||yr(t,e[c+1],s),f=yr(t,e[c+2]);l="mix("+p+", "+yr(t,e[c+3],s)+", pow(clamp(("+a+" - "+h+") / ("+f+" - "+h+"), 0.0, 1.0), "+u+"))"}return l}},pr.match={getReturnType:function(t){for(var e=hr,r=2;r<t.length;r+=2)e&=fr(t[r]);return e&fr(t[t.length-1])},toGlsl:function(t,e,r){Rr(e),br(e,4);var n=void 0!==r?r:hr,o=pr.match.getReturnType(e)&n;Sr(e,o);for(var i=yr(t,e[0]),s=yr(t,e[e.length-1],o),a=null,u=e.length-3;u>=1;u-=2)a="("+i+" == "+yr(t,e[u])+" ? "+yr(t,e[u+1],o)+" : "+(a||s)+")";return a}},pr.case={getReturnType:function(t){for(var e=hr,r=1;r<t.length;r+=2)e&=fr(t[r]);return e&fr(t[t.length-1])},toGlsl:function(t,e,r){!function(t){if(t.length%2==0)throw new Error("An odd amount of arguments was expected, got "+t+" instead")}(e),br(e,3);var n=void 0!==r?r:hr,o=pr.case.getReturnType(e)&n;Sr(e,o);for(var i=0;i<e.length-1;i+=2)Tr(e[i]);var s=yr(t,e[e.length-1],o),a=null;for(i=e.length-3;i>=0;i-=2)a="("+yr(t,e[i])+" ? "+yr(t,e[i+1],o)+" : "+(a||s)+")";return a}};var Ar=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Lr=function(t){function e(e){var r=this,n=e?Q({},e):{},o=n.style||{};delete n.style;var i=n.cacheSize;return delete n.cacheSize,(r=t.call(this,n)||this).style_=o,r.cacheSize_=i,r}return Ar(e,t),e.prototype.createRenderer=function(){var t=this.getSource(),e=function(t,e){var r={inFragmentShader:!0,variables:[],attributes:[],stringLiteralsMap:{},bandCount:e},n=[];if(void 0!==t.color){var o=yr(r,t.color,4);n.push("color = "+o+";")}if(void 0!==t.contrast){var i=yr(r,t.contrast,1);n.push("color.rgb = clamp(("+i+" + 1.0) * color.rgb - ("+i+" / 2.0), vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));")}if(void 0!==t.exposure){var s=yr(r,t.exposure,1);n.push("color.rgb = clamp(("+s+" + 1.0) * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));")}if(void 0!==t.saturation){var a=yr(r,t.saturation,1);n.push("\n      float saturation = "+a+" + 1.0;\n      float sr = (1.0 - saturation) * 0.2126;\n      float sg = (1.0 - saturation) * 0.7152;\n      float sb = (1.0 - saturation) * 0.0722;\n      mat3 saturationMatrix = mat3(\n        sr + saturation, sr, sr,\n        sg, sg + saturation, sg,\n        sb, sb, sb + saturation\n      );\n      color.rgb = clamp(saturationMatrix * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));\n    ")}if(void 0!==t.gamma){var u=yr(r,t.gamma,1);n.push("color.rgb = pow(color.rgb, vec3(1.0 / "+u+"));")}if(void 0!==t.brightness){var l=yr(r,t.brightness,1);n.push("color.rgb = clamp(color.rgb + "+l+", vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));")}var c={},h=r.variables.length;if(h>1&&!t.variables)throw new Error("Missing variables in style (expected "+r.variables+")");for(var p=function(e){var n=r.variables[e];if(!(n in t.variables))throw new Error("Missing '"+n+"' in style variables");var o=Cr(n);c[o]=function(){var e=t.variables[n];return"string"==typeof e&&(e=_r(r,e)),void 0!==e?e:-9999999}},f=0;f<h;++f)p(f);for(var d=Object.keys(c).map((function(t){return"uniform float "+t+";"})),g=Math.ceil(e/4),_=new Array(g),y=0;y<g;++y){var v=Ye+y;d.push("uniform sampler2D "+v+";"),_[y]="vec4 color"+y+" = texture2D("+v+", v_textureCoord);"}return{vertexShader:"\n    attribute vec2 a_textureCoord;\n    uniform mat4 u_tileTransform;\n    uniform float u_depth;\n\n    varying vec2 v_textureCoord;\n\n    void main() {\n      v_textureCoord = a_textureCoord;\n      gl_Position = u_tileTransform * vec4(a_textureCoord, u_depth, 1.0);\n    }\n  ",fragmentShader:"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    #else\n    precision mediump float;\n    #endif\n\n    varying vec2 v_textureCoord;\n    uniform float u_transitionAlpha;\n    uniform float u_texturePixelWidth;\n    uniform float u_texturePixelHeight;\n    uniform float u_resolution;\n    uniform float u_zoom;\n\n    "+d.join("\n")+"\n\n    void main() {\n      "+_.join("\n")+"\n\n      vec4 color = color0;\n\n      "+n.join("\n")+"\n\n      if (color.a == 0.0) {\n        discard;\n      }\n\n      gl_FragColor = color;\n      gl_FragColor.rgb *= gl_FragColor.a;\n      gl_FragColor *= "+"u_transitionAlpha;\n    }",uniforms:c}}(this.style_,"bandCount"in t?t.bandCount:4);return this.styleVariables_=this.style_.variables||{},new ir(this,{vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,className:this.getClassName(),cacheSize:this.cacheSize_})},e.prototype.updateStyleVariables=function(t){Q(this.styleVariables_,t),this.changed()},e}(oe);Lr.prototype.dispose;const Gr=Lr,Mr=/^#([0-9a-fA-F]{3,6})$/,Fr=/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)$/,Ir=t=>{if(4===t.length)return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)];if(7===t.length)return[parseInt(t[1]+t[2],16),parseInt(t[3]+t[4],16),parseInt(t[5]+t[6],16)];throw Error("invalid hex color, use #fff or #ffffff")},Ur=t=>{const e=t.match(Fr);return[+e[1]%255,+e[2]%255,+e[3]%255]},jr=(t,e,r)=>Math.round(e+(r-e)*t),Xr=t=>{const e=(t=>t.map((([t,e])=>{if(-1!=e.search(Mr))return[t,Ir(e)];if(-1!=e.search(Fr))return[t,Ur(e)];throw Error("invalid schema color, use #ffffff or rgb(255, 255, 255)")})))(t);return t=>{const r=((t,e)=>{if(t<e[0][0])return e[0][1];for(let r=1;r<e.length;r++)if(t<e[r][0])return[e[r-1],e[r]];return e[e.length-1][1]})(t,e);return 3===r.length?`rgb(${r[0]},${r[1]},${r[2]})`:((t,e,r)=>`rgb(${jr(t,e[0],r[0])},${jr(t,e[1],r[1])},${jr(t,e[2],r[2])})`)(((t,e,r)=>(t-e)/(r-e))(t,r[0][0],r[1][0]),r[0][1],r[1][1])}};class zr extends Gr{constructor({data:t,dataBbox:e,url:r,renderBbox:n,tileGrid:o,projection:i,compression:s,colorSchema:a,...u}){super({...u,visible:!1}),this.tileGrid=o||null,this.projection=i||"EPSG:3857",this.colorSchema=a||[[0,"#CD0074"],[21,"#7209AB"],[43,"#3914B0"],[64,"#1240AC"],[106,"#009A9A"],[128,"#00CC00"],[149,"#9FEE00"],[170,"#FFFF00"],[191,"#FFD300"],[213,"#FFAA00"],[234,"#FF7400"],[255,"#FF0000"]],this.colors=Xr(this.colorSchema),this.compression=s||4,this.size=256,this.dataBbox=e||[-180,-90,180,90],this.renderBbox=n||this.dataBbox,t?this.setData(t):r&&this.setUrl(r)}setColorSchema(t){this.colorSchema=t,this.colors=Xr(t)}setDataBbox(t){this.dataBbox=t,this.setRenderBbox(t),this._updatePart()}setRenderBbox(t){this.renderBbox=t}setTileGrid(t){this.tileGrid=t,this.source&&this.source.setTileGrid(t)}setProjection(t){this.projection=t,this.source&&this.source.setProjection(t)}setData(t){this.grid=t.grid,this.width=t.width,this._updatePart(),this._renderTiles()}setUrl(t){this.url=t,this._imgToArray(t).then((t=>{this.setData(t)}))}_updatePart(){this.width&&this.dataBbox&&(this.part=Math.round(this.width/Math.abs(this.dataBbox[2]-this.dataBbox[0])))}async _imgToArray(t){return new Promise(((e,r)=>{const n=new Image;n.onload=()=>{const t=document.createElement("canvas"),r=t.getContext("2d");t.width=n.width,t.height=n.height,r.drawImage(n,0,0);const o=r.getImageData(0,0,n.width,n.height).data;t.style.display="none";const i=new Uint8Array(o.length/4);for(let t=0;t<o.length;t+=4)i[t/4]=o[t];return e({grid:i,width:n.width})},n.onerror=r,n.src=t,n.crossOrigin="anonymous"}))}_renderTiles(){if(this.getSource())this.getRenderer().tileTextureCache_.clear(),this.changed();else{const t=this._getLoader();this.setSource(new Bt({loader:t,projection:this.projection,...this.tileGrid&&{tileGrid:this.tileGrid},transition:0})),this.setVisible(!0)}}_getLoader(){const t=document.createElement("canvas");t.width=this.size,t.height=this.size;const e=t.getContext("2d"),r=this.compression/2,n=this._getBboxConditionFunc();return(t,o,i)=>{const s=this.getSource().getTileGrid(),a=s.getOrigin(t),u=s.getTileSize(t)*s.getResolution(t),l=[a[0]+u*o,a[1]+u*(-i-1),a[0]+u*(o+1),a[1]+u*-i];e.clearRect(0,0,this.size,this.size);const c=(l[2]-l[0])/this.size;for(let t=0;t<=this.size;t+=this.compression)for(let o=0;o<=this.size;o+=this.compression){const i=(p=void 0,f=void 0,d=void 0,void 0,((g=(d=W([l[0]+c*(t+r),l[1]+c*(o+r)],void 0!==(h=this.projection)?h:"EPSG:3857","EPSG:4326"))[0])<-180||g>180)&&(d[0]=((f=(g+180)%(p=360))*p<0?f+p:f)-180),d);n(...i)&&(e.fillStyle=this.colors(this._getGridValue(...i)),e.fillRect(t-r,this.size-o-r,this.compression,this.compression))}var h,p,f,d,g;return Promise.resolve(new Uint8Array(e.getImageData(0,0,this.size,this.size).data.buffer))}}_getBboxConditionFunc(){return this.renderBbox[2]<this.renderBbox[0]?(t,e)=>t>=this.renderBbox[0]&&e>=this.renderBbox[1]&&e<=this.renderBbox[3]||t>=-180&&t<=this.renderBbox[2]&&e>=this.renderBbox[1]&&e<=this.renderBbox[3]:(t,e)=>t>=this.renderBbox[0]&&t<=this.renderBbox[2]&&e>=this.renderBbox[1]&&e<=this.renderBbox[3]}_getGridValue(t,e){const r=e,n=this.dataBbox[2]<this.dataBbox[0]&&t<=this.dataBbox[2]?t+360:t,o=Math.floor(r*this.part)/this.part,i=Math.ceil(r*this.part)/this.part,s=Math.floor(n*this.part)/this.part,a=Math.ceil(n*this.part)/this.part,u=this.grid[(this.dataBbox[3]-o)*this.part*this.width+(s-this.dataBbox[0])*this.part],l=this.grid[(this.dataBbox[3]-o)*this.part*this.width+(a-this.dataBbox[0])*this.part],c=(i-o)*(a-s);return u*(i-r)*(a-n)/c+this.grid[(this.dataBbox[3]-i)*this.part*this.width+(s-this.dataBbox[0])*this.part]*(r-o)*(a-n)/c+l*(i-r)*(n-s)/c+this.grid[(this.dataBbox[3]-i)*this.part*this.width+(a-this.dataBbox[0])*this.part]*(r-o)*(n-s)/c}}})(),HeatmapTile=e})();